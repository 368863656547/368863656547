AWSTemplateFormatVersion: 2010-09-09
Description: SonarQube and Jenkins Template
Parameters:
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the Elastic Beanstalk hosts
    Default: ShowcaseKeyPair
    Type: String
    MinLength: '1'
    MaxLength: '64'
    AllowedPattern: "[-_ a-zA-Z0-9]*"
    ConstraintDescription: can contain only alphanumeric characters, spaces, dashes and underscores.
  SecurityGroupName:
    Description: Name of an existing SecurityGroup
    Default: 'sg-0202f16ec9f8b415e'
    Type: String
    MinLength: '1'
    MaxLength: '64'
  SubnetIdName:
    Description: Name of an existing SubnetId
    Default: 'subnet-1732e96a'
    Type: String
    MinLength: '1'
    MaxLength: '64'
Resources:
#  sonarqubeinstance:
#    Type: 'AWS::EC2::Instance'
#    Properties:
#      DisableApiTermination: 'false'
#      InstanceInitiatedShutdownBehavior: 'stop'
#      ImageId: 'ami-ac442ac3'
#      InstanceType: 't2.small'
#      KeyName: 
#        Ref: KeyName
#      UserData: !Base64 
#        'Fn::Join':
#          - ''
#          - - |
#              #!/bin/bash -xe
#            - |
#              sudo yum -y update
#            - |
#              mkdir /home/ec2-user/sonarqube
#            - |
#              cd /home/ec2-user/sonarqube/
#            - |
#              sudo wget https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-7.0.zip
#            - |
#              unzip sonarqube-7.0.zip
#            - |
#              sudo yum install -y java-1.8.0
#            - |
#              sudo yum remove -y java-1.7.0-openjdk
#            - |
#              sudo rm -f *.zip
#            - |
#              sudo chown -R ec2-user:ec2-user /home/ec2-user/sonarqube
#            - |
#              sudo runuser -l ec2-user -c '/home/ec2-user/sonarqube/sonarqube-7.0/bin/linux-x86-64/sonar.sh console'
#      Monitoring: 'false'
#      Tags:
#        - Key: Name
#          Value: SonarQubeTestt
#      NetworkInterfaces:
#        - DeleteOnTermination: 'true'
#          Description: 'Primary network interface'
#          DeviceIndex: 0
#          SubnetId: 
#            Ref: SubnetIdName
##'subnet-1732e96a'
#          PrivateIpAddresses: 
#            - PrivateIpAddress: '172.31.42.222'
#              Primary: true
#          GroupSet: 
#            - Ref: SecurityGroupName
##             - 'sg-0202f16ec9f8b415e'
  jenkinsinstance:
    Type: 'AWS::EC2::Instance'
    Properties:
      # Ausgeschaltet um Stack besser resetten zu können !!!!
      DisableApiTermination: 'false'
      InstanceInitiatedShutdownBehavior: 'stop'
      ImageId: 'ami-ac442ac3'
      InstanceType: 't2.medium'
      IamInstanceProfile: 'EC2AdminAccessProfile'
      KeyName: 
        Ref: KeyName
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
              sudo yum -y update
              sudo yum remove -y java-1.7.0-openjdk
              echo 'Updates done'
              # Create Pem for Jenkins SSH 
              echo '-----BEGIN RSA PRIVATE KEY-----'                                              >> /tmp/ShowcaseKeyPair.pem
              echo 'MIIEogIBAAKCAQEAijsA6gaOYVCUZVdeXf/x6m6IFKpPkciHOh/k60ydgZo2pEmHD1fej0iZZWHS' >> /tmp/ShowcaseKeyPair.pem
              echo 'G4A2a4wluzO0GPJPDkiO3fhaVJimhLoWXmfPJzo0lk7WHZloUF2qNFrO+U6NTC2f7h0w92YqP4VU' >> /tmp/ShowcaseKeyPair.pem
              echo 'OlSnCxP/x0dockDw4fhDOGmwBP9FDYQK3VGmUNp2NrynX0bXKlHrmZ+H8AI4LE1ex5S2+8LJpQdt' >> /tmp/ShowcaseKeyPair.pem
              echo 'e4TpUFYKMh3acUxVGqetqqQaARwnKF1SltUmVb1Apyy8i0gL2v9H5RGxO7DWXg2lI75nF7njW7Kn' >> /tmp/ShowcaseKeyPair.pem
              echo 'UQDRO0oMXBGI3NCta5lH4yvKw3uAx+kfZzCJdXvjDBO/r+1Tr9GU8wIDAQABAoIBAEaTa5sRL97l' >> /tmp/ShowcaseKeyPair.pem
              echo '2m6HlineRPDR8G7Eqg2f2dNGd4Xfv0dtqlplJC0kSwDTK2bE9BaQdrigfJ9A/cIC7XQ4faE9bTlm' >> /tmp/ShowcaseKeyPair.pem
              echo 'GxcHP+aBkBXSNQlNRSslqUnnGMDUYHqPrbroTJCxnM+j/QwjkeaaVBNm6aAgiGZVW+ez7vY9l95l' >> /tmp/ShowcaseKeyPair.pem
              echo 'SydkdHucsV8UzO4XLrgXdwjACDnHHMvqmHW9NiO5N/wUJ29RdZdxhxzfQhL/9VwwQSibyg6B/Brc' >> /tmp/ShowcaseKeyPair.pem
              echo '+fq78S+SxyxXFE+I6Rcjajvn3abBGXGCARTQ6Y1Rb6NR/OBOYARcY9Ois6r6mNR5++Z4/ctGJeT6' >> /tmp/ShowcaseKeyPair.pem
              echo 'cWeGvghptn9538yPHG2XtH47v/ECgYEA50KU76zWGDg1l9a/+pC/eXTM9zfkMTFo42aSvgSN3MFi' >> /tmp/ShowcaseKeyPair.pem
              echo 'CPsQqsrXYQ1z7CBzv1QKJYGk0gUPsbmYa5gOvwYDKcovDvo24/Ks45dt3tjrbaW8BMKK1Z1Sq8IX' >> /tmp/ShowcaseKeyPair.pem
              echo '1Zk3bwJwmPRnSmEE3UshWI14IkbE7pJPgv8uY5UkpbUOMUZ8jDkCgYEAmQSpNsvZSWQ12OuS2icj' >> /tmp/ShowcaseKeyPair.pem
              echo 'iAUhvdeX2xzSG+cMkLEbuPpoqWXkoz18p1bH6ZoYXjww3EL8m+LYwcYIbmTLPrwbQQd3AR8qcfVL' >> /tmp/ShowcaseKeyPair.pem
              echo 'l7ziwT1ewvZyWjeb6+7XFhPcXZHJuWCHDmke63UZ60Ta7xuP5uLTCRe3qo98aO4SQ6H0RcvhAosC' >> /tmp/ShowcaseKeyPair.pem
              echo 'gYBmizuHW1hDvQjmny7ZaD2/GW+ZX4sr1QDxdJY088gDzywtV0Z4tSDzxAdW+LzaZeVp5Ca1idD/' >> /tmp/ShowcaseKeyPair.pem
              echo 'uZBAhVhkk8HrUd+0AHc+dGj9MjRh0EX0hLzuT2VIe04hIxt2d04BR0+uQxFaBdMmXR4YKgLPEBpa' >> /tmp/ShowcaseKeyPair.pem
              echo 'vz3KlGR5e7SYVcRJTTwE4QKBgAn3D74N0HzDFe6miM3ENsAo9WWToMQYQGaoyVyy7AdD54UAqb8n' >> /tmp/ShowcaseKeyPair.pem
              echo 'xfJv6F0COAwLB3OQuTq9rzgPWYU28zWGso+tmMZt7Sm2u9GJ74p+IKm5uwC9Fl5rE37QlE1TrTtx' >> /tmp/ShowcaseKeyPair.pem
              echo 'WdpKZkUXPzTfKxLfTKPQqcWx0bg91/BNcMsOxQW2nVS5AoGAIgUk9T2tjo4QtJIBc0vsGJ2tAptO' >> /tmp/ShowcaseKeyPair.pem
              echo 'WIXW6IcWeI2ZAVZfG/bJpUAT/6dNyTnetchFWW37bIH1bUPy3jvosoPv45EgM8Tr1VXRvD19ab4U' >> /tmp/ShowcaseKeyPair.pem
              echo 'mvfYoLOLAfHd7qM6hUwWChftKybrMiPAT+fb1aSlgyCh931k0v9QC33VaFmyEGoT98A='         >> /tmp/ShowcaseKeyPair.pem
              echo '-----END RSA PRIVATE KEY-----'                                                >> /tmp/ShowcaseKeyPair.pem              
              chmod 400 /tmp/ShowcaseKeyPair.pem
              echo 'Pem created'
              # Install Git
              yum install -y git
              #Install Jenkins
              wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
              rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key
              yum -y install jenkins
              sed -i 's/\$JENKINS_JAVA_CMD \$JENKINS_JAVA_OPTIONS -DJENKINS_HOME=\$JENKINS_HOME -jar \$JENKINS_WAR/\$JENKINS_JAVA_CMD \$JENKINS_JAVA_OPTIONS -Djenkins.install.runSetupWizard=false -DJENKINS_HOME=\$JENKINS_HOME -jar \$JENKINS_WAR/g' /etc/init.d/jenkins
              echo 'Install Jenkins done'
              # Config Jenkins User
              usermod -s /bin/sh jenkins
              sudo su jenkins
              mkdir ~/.aws
              echo "[default]" > ~/.aws/config
              echo "output = json" >> ~/.aws/config
              echo "region = eu-central-1" >> ~/.aws/config
              sudo su
              echo "jenkins    ALL = NOPASSWD: ALL" >> /etc/sudoers
              echo 'Jenkins User configured'
              # Install Docker & Docker Compose
              yum install -y docker
              service docker start
              usermod -a -G docker ec2-user
              usermod -a -G docker jenkins
              curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose
              chmod +x /usr/bin/docker-compose
              chkconfig docker on
              docker-compose --version
              chmod 666 /var/run/docker.*
              chown root:users /var/run/docker/ -R
              echo 'Docker & Dcoker Compose installed'
              # Install Oracle Java JDK 8
              wget --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.rpm
              yum install -y jdk-8u141-linux-x64.rpm
              service jenkins start
              # Installation Gradle
              mkdir /opt/gradle
              cd /opt/gradle
              wget -c http://services.gradle.org/distributions/gradle-4.6-all.zip
              unzip -d /opt/gradle gradle-4.6-all.zip
              export PATH=$PATH:/opt/gradle/gradle-4.6/bin
              sudo runuser -l jenkins -c 'export PATH=$PATH:/opt/gradle/gradle-4.6/bin'
              # Installation Maven
              wget http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo -O /etc/yum.repos.d/epel-apache-maven.repo
              sed -i s/\$releasever/6/g /etc/yum.repos.d/epel-apache-maven.repo
              yum install -y apache-maven
              # Download Jenkins Cli & Install Plugins: BlueOcean, Html Publisher, Lockable Resources
              mkdir /opt/jenkins_cli
              cd /opt/jenkins_cli
              sudo wget http://127.0.0.1:8080/jnlpJars/jenkins-cli.jar
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin htmlpublisher
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin lockable-resources
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin pipeline-build-step
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin saferestart
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin credentials
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin git
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin sonar
              # Blue Ocean scheint über CLI nicht nutzbar zu sein
              java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ install-plugin blueocean
              #service jenkins restart
              # Create Credentials for GitHub
              echo '<com.cloudbees.plugins.credentials.domains.Domain>'                        >> /opt/jenkins_cli/domain.xml
              echo '    <name>GithubCredentials</name>'                                        >> /opt/jenkins_cli/domain.xml
              echo '</com.cloudbees.plugins.credentials.domains.Domain>'                       >> /opt/jenkins_cli/domain.xml
              echo '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>'  >> /opt/jenkins_cli/githubcred.xml
              echo '  <scope>GLOBAL</scope>'                                                   >> /opt/jenkins_cli/githubcred.xml
              echo '  <id>368863656547</id>'                                                     >> /opt/jenkins_cli/githubcred.xml
              echo '  <description></description>'                                   >> /opt/jenkins_cli/githubcred.xml
              echo '  <username>368863656547</username>'                                          >> /opt/jenkins_cli/githubcred.xml
              echo '  <password>Materna.123</password>'                                        >> /opt/jenkins_cli/githubcred.xml
              echo '</com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' >> /opt/jenkins_cli/githubcred.xml
              chmod +x /opt/jenkins_cli/domain.xml
              chmod +x /opt/jenkins_cli/githubcred.xml
              chown root:users /opt/jenkins_cli/domain.xml
              chown root:users /opt/jenkins_cli/githubcred.xml
              cd /opt/jenkins_cli
              # Warten, da Jenkins neustartet und der nächste Befehl auf einen Timeout läuft
              sleep 30
              #cat domain.xml | java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ create-credentials-domain-by-xml "SystemCredentialsProvider::SystemContextResolver::jenkins"
              # Sleep sonst Timeout, vermutlich vorheriger Befehl
              sleep 10
              cat githubcred.xml | java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ create-credentials-by-xml "SystemCredentialsProvider::SystemContextResolver::jenkins" "(global)"
              # Create Jenkins Pipeline Job
              echo "<?xml version='1.1' encoding='UTF-8'?>"                                                >> /opt/jenkins_cli/job1.xml
              echo '<flow-definition plugin="workflow-job@2.17">'                                          >> /opt/jenkins_cli/job1.xml
              echo '  <actions>'                                                                           >> /opt/jenkins_cli/job1.xml
              echo '    <org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobAction plugin="pipeline-model-definition@1.2.7"/>'                                                  >> /opt/jenkins_cli/job1.xml
              echo '    <org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobPropertyTrackerAction plugin="pipeline-model-definition@1.2.7">'                                                   >> /opt/jenkins_cli/job1.xml
              echo '      <jobProperties/>'                                                                >> /opt/jenkins_cli/job1.xml
              echo '      <triggers/>'                                                                     >> /opt/jenkins_cli/job1.xml
              echo '      <parameters/>'                                                                   >> /opt/jenkins_cli/job1.xml
              echo '    </org.jenkinsci.plugins.pipeline.modeldefinition.actions.DeclarativeJobPropertyTrackerAction>'                                                                                                                                        >> /opt/jenkins_cli/job1.xml
              echo '  </actions>'                                                                          >> /opt/jenkins_cli/job1.xml
              echo '  <description></description>'                                                         >> /opt/jenkins_cli/job1.xml
              echo '  <keepDependencies>false</keepDependencies>'                                          >> /opt/jenkins_cli/job1.xml
              echo '  <properties>'                                                                        >> /opt/jenkins_cli/job1.xml
              echo '    <org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>'       >> /opt/jenkins_cli/job1.xml
              echo '      <triggers>'                                                                      >> /opt/jenkins_cli/job1.xml
              echo '        <hudson.triggers.SCMTrigger>'                                                  >> /opt/jenkins_cli/job1.xml
              echo '          <spec>* * * * *</spec>'                                                      >> /opt/jenkins_cli/job1.xml
              echo '          <ignorePostCommitHooks>false</ignorePostCommitHooks>'                        >> /opt/jenkins_cli/job1.xml
              echo '        </hudson.triggers.SCMTrigger>'                                                 >> /opt/jenkins_cli/job1.xml
              echo '      </triggers>'                                                                     >> /opt/jenkins_cli/job1.xml
              echo '    </org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>'      >> /opt/jenkins_cli/job1.xml
              echo '  </properties>'                                                                       >> /opt/jenkins_cli/job1.xml
              echo '  <definition class="org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition" plugin="workflow-cps@2.45">'                                                                 >> /opt/jenkins_cli/job1.xml
              echo '    <scm class="hudson.plugins.git.GitSCM" plugin="git@3.8.0">'                        >> /opt/jenkins_cli/job1.xml
              echo '      <configVersion>2</configVersion>'                                                >> /opt/jenkins_cli/job1.xml
              echo '      <userRemoteConfigs>'                                                             >> /opt/jenkins_cli/job1.xml
              echo '        <hudson.plugins.git.UserRemoteConfig>'                                         >> /opt/jenkins_cli/job1.xml
              echo '          <url>https://github.com/368863656547/368863656547.git</url>'                 >> /opt/jenkins_cli/job1.xml
              echo '          <credentialsId>368863656547</credentialsId>'                                 >> /opt/jenkins_cli/job1.xml
              echo '        </hudson.plugins.git.UserRemoteConfig>'                                        >> /opt/jenkins_cli/job1.xml
              echo '      </userRemoteConfigs>'                                                            >> /opt/jenkins_cli/job1.xml
              echo '      <branches>'                                                                      >> /opt/jenkins_cli/job1.xml
              echo '        <hudson.plugins.git.BranchSpec>'                                               >> /opt/jenkins_cli/job1.xml
              echo '          <name>*/master</name>'                                                       >> /opt/jenkins_cli/job1.xml
              echo '        </hudson.plugins.git.BranchSpec>'                                              >> /opt/jenkins_cli/job1.xml
              echo '      </branches>'                                                                     >> /opt/jenkins_cli/job1.xml
              echo '      <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>'    >> /opt/jenkins_cli/job1.xml
              echo '      <submoduleCfg class="list"/>'                                                    >> /opt/jenkins_cli/job1.xml
              echo '      <extensions/>'                                                                   >> /opt/jenkins_cli/job1.xml
              echo '    </scm>'                                                                            >> /opt/jenkins_cli/job1.xml
              echo '    <scriptPath>config/pipeline/pipeline.groovy</scriptPath>'                          >> /opt/jenkins_cli/job1.xml
              echo '    <lightweight>false</lightweight>'                                                  >> /opt/jenkins_cli/job1.xml
              echo '  </definition>'                                                                       >> /opt/jenkins_cli/job1.xml
              echo '  <triggers/>'                                                                         >> /opt/jenkins_cli/job1.xml
              echo '  <disabled>false</disabled>'                                                          >> /opt/jenkins_cli/job1.xml
              echo '</flow-definition>'                                                                    >> /opt/jenkins_cli/job1.xml
              cat job1.xml | java -jar jenkins-cli.jar -s http://127.0.0.1:8080/ create-job Atsea-Shop
              echo '<?xml version='1.1' encoding='UTF-8'?>'                                                >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '<hudson.plugins.sonar.SonarRunnerInstallation_-DescriptorImpl plugin="sonar@2.6.1">'   >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '  <installations>'                                                                     >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '    <hudson.plugins.sonar.SonarRunnerInstallation>'                                    >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '      <name>ShowcaseQubeScanner</name>'                                                >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '      <properties>'                                                                    >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '        <hudson.tools.InstallSourceProperty>'                                          >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '          <installers>'                                                                >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '            <hudson.plugins.sonar.SonarRunnerInstaller>'                               >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '              <id>3.1.0.1141</id>'                                                     >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '            </hudson.plugins.sonar.SonarRunnerInstaller>'                              >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '          </installers>'                                                               >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '        </hudson.tools.InstallSourceProperty>'                                         >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '      </properties>'                                                                   >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '    </hudson.plugins.sonar.SonarRunnerInstallation>'                                   >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '  </installations>'                                                                    >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '</hudson.plugins.sonar.SonarRunnerInstallation_-DescriptorImpl>'                       >> /var/lib/jenkins/hudson.plugins.sonar.SonarRunnerInstallation.xml
              echo '-----BEGIN RSA PRIVATE KEY-----'                                              >> /var/lib/jenkins/KOPSinstance.pem
              echo 'MIIEogIBAAKCAQEAijsA6gaOYVCUZVdeXf/x6m6IFKpPkciHOh/k60ydgZo2pEmHD1fej0iZZWHS' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'G4A2a4wluzO0GPJPDkiO3fhaVJimhLoWXmfPJzo0lk7WHZloUF2qNFrO+U6NTC2f7h0w92YqP4VU' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'OlSnCxP/x0dockDw4fhDOGmwBP9FDYQK3VGmUNp2NrynX0bXKlHrmZ+H8AI4LE1ex5S2+8LJpQdt' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'e4TpUFYKMh3acUxVGqetqqQaARwnKF1SltUmVb1Apyy8i0gL2v9H5RGxO7DWXg2lI75nF7njW7Kn' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'UQDRO0oMXBGI3NCta5lH4yvKw3uAx+kfZzCJdXvjDBO/r+1Tr9GU8wIDAQABAoIBAEaTa5sRL97l' >> /var/lib/jenkins/KOPSinstance.pem
              echo '2m6HlineRPDR8G7Eqg2f2dNGd4Xfv0dtqlplJC0kSwDTK2bE9BaQdrigfJ9A/cIC7XQ4faE9bTlm' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'GxcHP+aBkBXSNQlNRSslqUnnGMDUYHqPrbroTJCxnM+j/QwjkeaaVBNm6aAgiGZVW+ez7vY9l95l' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'SydkdHucsV8UzO4XLrgXdwjACDnHHMvqmHW9NiO5N/wUJ29RdZdxhxzfQhL/9VwwQSibyg6B/Brc' >> /var/lib/jenkins/KOPSinstance.pem
              echo '+fq78S+SxyxXFE+I6Rcjajvn3abBGXGCARTQ6Y1Rb6NR/OBOYARcY9Ois6r6mNR5++Z4/ctGJeT6' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'cWeGvghptn9538yPHG2XtH47v/ECgYEA50KU76zWGDg1l9a/+pC/eXTM9zfkMTFo42aSvgSN3MFi' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'CPsQqsrXYQ1z7CBzv1QKJYGk0gUPsbmYa5gOvwYDKcovDvo24/Ks45dt3tjrbaW8BMKK1Z1Sq8IX' >> /var/lib/jenkins/KOPSinstance.pem
              echo '1Zk3bwJwmPRnSmEE3UshWI14IkbE7pJPgv8uY5UkpbUOMUZ8jDkCgYEAmQSpNsvZSWQ12OuS2icj' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'iAUhvdeX2xzSG+cMkLEbuPpoqWXkoz18p1bH6ZoYXjww3EL8m+LYwcYIbmTLPrwbQQd3AR8qcfVL' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'l7ziwT1ewvZyWjeb6+7XFhPcXZHJuWCHDmke63UZ60Ta7xuP5uLTCRe3qo98aO4SQ6H0RcvhAosC' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'gYBmizuHW1hDvQjmny7ZaD2/GW+ZX4sr1QDxdJY088gDzywtV0Z4tSDzxAdW+LzaZeVp5Ca1idD/' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'uZBAhVhkk8HrUd+0AHc+dGj9MjRh0EX0hLzuT2VIe04hIxt2d04BR0+uQxFaBdMmXR4YKgLPEBpa' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'vz3KlGR5e7SYVcRJTTwE4QKBgAn3D74N0HzDFe6miM3ENsAo9WWToMQYQGaoyVyy7AdD54UAqb8n' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'xfJv6F0COAwLB3OQuTq9rzgPWYU28zWGso+tmMZt7Sm2u9GJ74p+IKm5uwC9Fl5rE37QlE1TrTtx' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'WdpKZkUXPzTfKxLfTKPQqcWx0bg91/BNcMsOxQW2nVS5AoGAIgUk9T2tjo4QtJIBc0vsGJ2tAptO' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'WIXW6IcWeI2ZAVZfG/bJpUAT/6dNyTnetchFWW37bIH1bUPy3jvosoPv45EgM8Tr1VXRvD19ab4U' >> /var/lib/jenkins/KOPSinstance.pem
              echo 'mvfYoLOLAfHd7qM6hUwWChftKybrMiPAT+fb1aSlgyCh931k0v9QC33VaFmyEGoT98A='         >> /var/lib/jenkins/KOPSinstance.pem
              echo '-----END RSA PRIVATE KEY-----'                                                >> /var/lib/jenkins/KOPSinstance.pem
              chown jenkins:jenkins /var/lib/jenkins/KOPSinstance.pem
              service jenkins restart
              # Initiale SSH Verbindung gegen die KOPSInstanz aufbauen
              ssh -oStrictHostKeyChecking=no -i /tmp/ShowcaseKeyPair.pem ec2-user@172.31.43.137
              exit
              echo 'Initial SSH Connection etablished'
      Monitoring: 'false'
      Tags:
        - Key: Name
          Value: JenkinsTestt
      NetworkInterfaces:
        - DeleteOnTermination: 'true'
          Description: 'Primary network interface'
          DeviceIndex: 0
          SubnetId: 
            Ref: SubnetIdName
          PrivateIpAddresses: 
            - PrivateIpAddress: '172.31.33.223'
              Primary: true
          GroupSet: 
            - Ref: SecurityGroupName
